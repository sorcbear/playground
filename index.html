<!doctype html>
<html lang="zh">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Circle Puzzle</title>
  <style>
    :root { --maxw: 720px; }
    body{
      margin:0;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "PingFang SC",
                   "Hiragino Sans GB", "Microsoft YaHei", Arial, sans-serif;
      background:#fff;
      color:#111;
    }
    .wrap{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 12px;
    }
    .stage{
      width: 100%;
      aspect-ratio: 918 / 1024;  /* 必须和 viewBox 一致，保证无留白偏移 */
      border-radius: 10px;
      overflow: hidden;
      background:#fff;
      touch-action: manipulation;
      user-select: none;
    }
    svg{
      width:100%;
      height:100%;
      display:block;
    }

    /* 点击层：透明圆，负责接收点击 */
    .hit {
      fill: rgba(0,0,0,0);
      stroke: rgba(0,0,0,0);
      pointer-events: all;
    }

    /* 红点层：统一大小，选中才显示 */
    .dot {
      fill: rgba(220, 0, 0, 0);
      pointer-events: none;
    }
    .hit.selected + .dot {
      fill: rgba(220, 0, 0, 0.92);
    }

    .panel{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content: space-between;
      margin-top: 12px;
      flex-wrap: wrap;
    }
    button{
      appearance:none;
      border:0;
      background:#111;
      color:#fff;
      padding: 12px 16px;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
    }
    button:active{ transform: translateY(1px); }
    .msg{
      flex:1;
      min-width: 220px;
      padding: 10px 12px;
      border-radius: 10px;
      background:#f5f5f5;
      font-size: 14px;
      line-height: 1.35;
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="stage">
      <!-- 关键：图片放在同一个 SVG 坐标系里，避免缩放偏移 -->
      <svg viewBox="0 0 918 1024" preserveAspectRatio="xMidYMid meet" id="svg" aria-label="circle puzzle">
        <image href="map.png" x="0" y="0" width="918" height="1024" preserveAspectRatio="xMidYMid meet" style="pointer-events:none;"></image>
      </svg>
    </div>

    <div class="panel">
      <button id="submitBtn">Submit</button>
      <div class="msg" id="msg">点击空心圆选择/取消，然后 Submit。</div>
    </div>
  </div>

<script>
/**
 * 圆圈中心点坐标（46个）——仍然用你之前那份
 * 但半径统一由 R_HIT / R_DOT 控制，避免红点大小不一致
 */
const CIRCLES = [
  {"x":677,"y":83},{"x":751,"y":88},{"x":376,"y":166},{"x":476,"y":168},{"x":562,"y":171},
  {"x":657,"y":219},{"x":307,"y":263},{"x":399,"y":274},{"x":494,"y":280},{"x":92,"y":301},
  {"x":170,"y":307},{"x":825,"y":315},{"x":900,"y":327},{"x":217,"y":346},{"x":303,"y":346},
  {"x":575,"y":356},{"x":245,"y":361},{"x":142,"y":388},{"x":80,"y":433},{"x":38,"y":436},
  {"x":232,"y":438},{"x":178,"y":484},{"x":533,"y":506},{"x":405,"y":512},{"x":290,"y":517},
  {"x":489,"y":554},{"x":273,"y":550},{"x":314,"y":556},{"x":689,"y":563},{"x":601,"y":575},
  {"x":450,"y":618},{"x":827,"y":659},{"x":880,"y":670},{"x":714,"y":689},{"x":388,"y":697},
  {"x":302,"y":717},{"x":579,"y":730},{"x":475,"y":757},{"x":859,"y":758},{"x":915,"y":765},
  {"x":644,"y":827},{"x":506,"y":865},{"x":433,"y":878},{"x":332,"y":893},{"x":256,"y":908},
  {"x":119,"y":699}
];

// 统一半径：你截图里圆圈看起来基本等大，建议先用这个值
const R_HIT = 18;   // 点击圆半径（不加大：固定为圆本身大小）
const R_DOT = 15;   // 红点半径（略小于空心圆内径，看起来像“填满”但保留黑边）

/**
 * 正确答案（不显示编号，内部用 1-based 编号做校验）
 * SHA-256("3,17,18,22,28,35,38,42,45")
 */
const ANSWER_HASH = "a1ab820fa8147f425c00db6d397099d7e4eea44acc24c810cfb56ba96a016e71";

const svg = document.getElementById("svg");
const msg = document.getElementById("msg");
const submitBtn = document.getElementById("submitBtn");

const selected = new Array(CIRCLES.length).fill(false);

function el(name, attrs = {}) {
  const n = document.createElementNS("http://www.w3.org/2000/svg", name);
  for (const [k,v] of Object.entries(attrs)) n.setAttribute(k, v);
  return n;
}

function render(){
  // 先把旧的 hit/dot 清掉（保留第一个 <image>）
  [...svg.querySelectorAll(".hit,.dot")].forEach(n => n.remove());

  CIRCLES.forEach((c, i) => {
    const hit = el("circle", { cx: c.x, cy: c.y, r: R_HIT });
    hit.classList.add("hit");
    if (selected[i]) hit.classList.add("selected");

    const dot = el("circle", { cx: c.x, cy: c.y, r: R_DOT });
    dot.classList.add("dot");

    hit.addEventListener("click", (e) => {
      e.preventDefault();
      selected[i] = !selected[i];
      render();
    }, { passive: false });

    svg.appendChild(hit);
    svg.appendChild(dot);
  });
}

async function sha256Hex(str){
  const data = new TextEncoder().encode(str);
  const hashBuf = await crypto.subtle.digest("SHA-256", data);
  return Array.from(new Uint8Array(hashBuf)).map(b => b.toString(16).padStart(2,"0")).join("");
}

submitBtn.addEventListener("click", async () => {
  const chosen = selected
    .map((v,i)=> v ? (i+1) : null)
    .filter(v=>v!==null)
    .sort((a,b)=>a-b);

  const key = chosen.join(",");
  const h = await sha256Hex(key);

  if (h === ANSWER_HASH){
    msg.textContent = "Success";
    msg.style.background = "#e9f7ef";
  } else {
    msg.textContent = "Please try again";
    msg.style.background = "#fdecec";
  }
});

render();
</script>
</body>
</html>
