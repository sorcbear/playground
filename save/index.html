<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Save</title>

  <style>
    :root{
      --maxw: 720px;

      --fs-body: 18px;
      --lh-body: 1.7;

      --btn-h: 52px;
      --gap: 18px;

      --c-text:#111;
      --c-border:#000;
      --bg:#fff;

      /* 左侧路线区域宽度（包含竖线+圆点） */
      --rail-area: 56px;

      /* SVG 中竖线 x 坐标（在 rail-area 内） */
      --rail-x: 22px;

      /* 圆点大小（SVG用） */
      --dot-r: 6px;

      /* 每个 step 的垂直节距（影响圆点间距） */
      --step-pad-y: 14px;
    }

    *{ box-sizing:border-box; }

    html,body{
      margin:0;
      padding:0;
      width:100%;
      min-height:100%;
      background:var(--bg);
      color:var(--c-text);
      font-family: system-ui, -apple-system, "PingFang SC","Microsoft YaHei", Arial, sans-serif;
      font-size:var(--fs-body);
      line-height:var(--lh-body);
    }

    .wrap{
      max-width:var(--maxw);
      margin:0 auto;
      padding:24px 16px 40px;
    }

    .card{
      width:100%;
      margin:0 auto;
      padding:18px 14px;
      border:2px solid var(--c-border);
      background:#fff;
    }

    /* 关键：一列是“路线SVG”，一列是“按钮列表” */
    .layout{
      display:grid;
      grid-template-columns: var(--rail-area) 1fr;
      column-gap: 14px;
      align-items:start;
    }

    /* 左侧路线容器 */
    .railBox{
      position:relative;
      width:var(--rail-area);
      /* 高度由 JS 按步骤数动态设置 */
    }

    .railSvg{
      display:block;
      width:100%;
      height:100%;
    }

    /* 右侧按钮列表 */
    .steps{
      display:flex;
      flex-direction:column;
    }

    .stepRow{
      /* 与 SVG 圆点保持同样的垂直节距 */
      padding: var(--step-pad-y) 0;
      display:flex;
      align-items:center;
    }

    /* 按钮：自适应宽度 */
    .btn{
      height:var(--btn-h);
      padding:0 18px;

      display:inline-flex;
      align-items:center;
      justify-content:flex-start;
      gap:12px;

      font-size:var(--fs-body);
      font-weight:600;

      background:#fff;
      color:#000;
      border:2px solid var(--c-border);
      cursor:pointer;
      border-radius:0;

      -webkit-tap-highlight-color: transparent;
      user-select:none;
      white-space:nowrap;
    }
    .btn:hover{ background:#000; color:#fff; }
    .btn:disabled{ opacity:.45; cursor:default; }

    /* 图标 */
    .ico{
      width:28px;
      height:28px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      flex:0 0 auto;
    }
    .ico svg{ width:100%; height:100%; display:block; }

    .label{
      display:inline-block;
      line-height:1;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="card">
      <div class="layout">
        <!-- 左：路线 SVG（由 JS 画竖线+圆点；不会出现在按钮旁边） -->
        <div class="railBox" id="railBox">
          <svg class="railSvg" id="railSvg" viewBox="0 0 56 10" preserveAspectRatio="none" aria-hidden="true"></svg>
        </div>

        <!-- 右：按钮列表 -->
        <div class="steps" id="steps"></div>
      </div>
    </div>
  </div>

  <script>
    // ====== 存档 key（写入一次后永久显示）======
    const K_UNLOCK_CIRCLE = "pg_unlock_circle_v1"; // rotate 正确后解锁：天平路（circle）
    const K_UNLOCK_SQUARE = "pg_unlock_square_v1"; // address 正确后解锁：康平路（square）
    const K_UNLOCK_PPL    = "pg_unlock_ppl_v1";    // post 正确后解锁：衡山路（ppl）

    const STEP_ALL = [
      { id:"start",  text:"起点",   url:"https://sorcbear.github.io/playground/rotate",  needKey:null,            icon: svgStart },
      { id:"circle", text:"天平路", url:"https://sorcbear.github.io/playground/circle",  needKey:K_UNLOCK_CIRCLE, icon: svgBlueSquare },
      { id:"square", text:"康平路", url:"https://sorcbear.github.io/playground/square",  needKey:K_UNLOCK_SQUARE, icon: svgGreenCircle },
      { id:"ppl",    text:"衡山路", url:"https://sorcbear.github.io/playground/ppl",     needKey:K_UNLOCK_PPL,    icon: svgRedDiamond },
    ];

    function safeGet(key){
      try { return window.localStorage.getItem(key); } catch(e){ return null; }
    }
    function isUnlocked(needKey){
      if (!needKey) return true;
      return !!safeGet(needKey);
    }

    // ====== 4 个彩色矢量图标 ======
    function svgStart(){
      return `
        <svg viewBox="0 0 64 64" aria-hidden="true">
          <path d="M32 6a26 26 0 1 0 0 52a26 26 0 0 0 0-52Z" fill="#F6B300"/>
          <path d="M32 32L58 18v28L32 32Z" fill="#fff"/>
        </svg>
      `;
    }
    function svgBlueSquare(){
      return `
        <svg viewBox="0 0 64 64" aria-hidden="true">
          <rect x="10" y="10" width="44" height="44" fill="#1E73D8"/>
        </svg>
      `;
    }
    function svgGreenCircle(){
      return `
        <svg viewBox="0 0 64 64" aria-hidden="true">
          <circle cx="32" cy="32" r="22" fill="#2E7D32"/>
        </svg>
      `;
    }
    function svgRedDiamond(){
      return `
        <svg viewBox="0 0 64 64" aria-hidden="true">
          <path d="M32 8L56 32 32 56 8 32 32 8Z" fill="#D32F2F"/>
        </svg>
      `;
    }

    // ====== 生成按钮行 ======
    function makeBtn(iconSVG, text, url){
      const btn = document.createElement("button");
      btn.className = "btn";
      btn.type = "button";
      btn.innerHTML = `
        <span class="ico">${iconSVG}</span>
        <span class="label">${text}</span>
      `;
      btn.onclick = () => { location.href = url; };
      return btn;
    }

    function renderSteps(unlockedSteps){
      const stepsEl = document.getElementById("steps");
      stepsEl.innerHTML = "";

      for (const s of unlockedSteps){
        const row = document.createElement("div");
        row.className = "stepRow";
        row.appendChild(makeBtn(s.icon(), s.text, s.url));
        stepsEl.appendChild(row);
      }
    }

    // ====== 画路线 SVG：竖线 + 圆点节点（只在左侧，不进入按钮） ======
    function drawRail(unlockedCount){
      const railBox = document.getElementById("railBox");
      const svg = document.getElementById("railSvg");

      const styles = getComputedStyle(document.documentElement);
      const railArea = parseFloat(styles.getPropertyValue("--rail-area")) || 56;
      const railX = parseFloat(styles.getPropertyValue("--rail-x")) || 22;
      const dotR = parseFloat(styles.getPropertyValue("--dot-r")) || 6;
      const stepPadY = parseFloat(styles.getPropertyValue("--step-pad-y")) || 14;
      const btnH = parseFloat(styles.getPropertyValue("--btn-h")) || 52;

      // 每个 stepRow 的总高度 = 上下 padding + 按钮高度
      const stepH = stepPadY * 2 + btnH;

      // 顶部/底部留一点呼吸
      const topMargin = 10;
      const bottomMargin = 10;

      // SVG 真实高度
      const h = topMargin + unlockedCount * stepH + bottomMargin;

      railBox.style.height = h + "px";

      // 设置 viewBox 与尺寸
      svg.setAttribute("viewBox", `0 0 ${railArea} ${h}`);
      svg.setAttribute("width", railArea);
      svg.setAttribute("height", h);

      // 清空
      svg.innerHTML = "";

      // 竖线：从第一个圆点到最后一个圆点
      if (unlockedCount >= 1){
        const yFirst = topMargin + stepPadY + btnH / 2;
        const yLast  = topMargin + (unlockedCount - 1) * stepH + stepPadY + btnH / 2;

        const line = document.createElementNS("http://www.w3.org/2000/svg", "line");
        line.setAttribute("x1", railX);
        line.setAttribute("x2", railX);
        line.setAttribute("y1", yFirst);
        line.setAttribute("y2", yLast);
        line.setAttribute("stroke", "#000");
        line.setAttribute("stroke-width", "4");
        line.setAttribute("stroke-linecap", "square");
        svg.appendChild(line);

        // 圆点节点
        for (let i = 0; i < unlockedCount; i++){
          const cy = topMargin + i * stepH + stepPadY + btnH / 2;

          const c = document.createElementNS("http://www.w3.org/2000/svg", "circle");
          c.setAttribute("cx", railX);
          c.setAttribute("cy", cy);
          c.setAttribute("r", dotR);
          c.setAttribute("fill", "#fff");
          c.setAttribute("stroke", "#000");
          c.setAttribute("stroke-width", "2");
          svg.appendChild(c);
        }
      }
    }

    function render(){
      const unlockedSteps = STEP_ALL.filter(s => isUnlocked(s.needKey));
      renderSteps(unlockedSteps);
      drawRail(unlockedSteps.length);
    }

    render();

    // ======（可选）调试：加 ?reset=1 清空存档 ======
    // if (new URLSearchParams(location.search).get("reset") === "1") {
    //   localStorage.removeItem(K_UNLOCK_CIRCLE);
    //   localStorage.removeItem(K_UNLOCK_SQUARE);
    //   localStorage.removeItem(K_UNLOCK_PPL);
    //   location.replace(location.pathname);
    // }
  </script>
</body>
</html>
