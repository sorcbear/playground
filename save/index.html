<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Save</title>

  <style>
    :root{
      --fs-body: 18px;
      --btn-h: 56px;

      --c-border:#000;
      --bg:#fff;

      --map-w: 780px;
      --map-h: 520px;

      --line-w: 4px;
    }

    *{ box-sizing:border-box; }

    html,body{
      margin:0;
      padding:0;
      background:#fff;
      font-family: system-ui, -apple-system, "PingFang SC","Microsoft YaHei", Arial, sans-serif;
      font-size:var(--fs-body);
      color:#111;
    }

    .wrap{
      min-height:100svh;
      display:flex;
      justify-content:center;
      padding:32px 16px;
    }

    .map{
      position:relative;
      width:min(var(--map-w), 100%);
      aspect-ratio: calc(var(--map-w) / var(--map-h));
    }

    .wires{
      position:absolute;
      inset:0;
      pointer-events:none;
    }

    .node{
      position:absolute;
      transform:translate(-50%, -50%);
    }

    .btn{
      width: 140px; 
      height:var(--btn-h);
      padding:0 24px;
      justify-content: center;


      display:inline-flex;
      align-items:center;
      gap:14px;

      font-size:var(--fs-body);
      font-weight:600;

      background:#fff;         /* ✅ 未选中纯白 */
      color:#000;
      border:2px solid #000;
      cursor:pointer;
      border-radius:0;

      appearance:none;
      -webkit-appearance:none;
      background-image:none;
      box-shadow:none;

      white-space:nowrap;
      -webkit-tap-highlight-color: transparent;
      user-select:none;
    }
    .btn:hover{ background:#000; color:#fff; }

    .ico{
      width:28px;
      height:28px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex:0 0 auto;
    }
    .ico svg{ width:100%; height:100%; display:block; }

    /* 起点三角：白底白三角，hover 黑底黑三角 */
    .start-tri{ fill:#fff; }
    .btn:hover .start-tri{ fill:#000; }

    /* debug 面板 */
    .debug{
      position:fixed;
      left:12px;
      bottom:12px;
      padding:10px 12px;
      border:2px solid #000;
      background:#fff;
      font-size:14px;
      line-height:1.5;
      max-width: calc(100vw - 24px);
      word-break:break-all;
    }
  </style>
</head>

<body>
<div class="wrap">
  <div class="map" id="map">
    <svg class="wires" id="wires" viewBox="0 0 780 520" preserveAspectRatio="none"></svg>
  </div>
</div>

<script>
  // ===== 存档 key =====
  const K_UNLOCK_CIRCLE = "pg_unlock_circle_v1";
  const K_UNLOCK_SQUARE = "pg_unlock_square_v1";
  const K_UNLOCK_PPL    = "pg_unlock_ppl_v1";

  // ===== 节点（按你图的折线布局）=====
  const NODES = [
    { text:"起点",   url:"https://sorcbear.github.io/playground/rotate", need:null,            x:140, y:110, icon:svgStart },
    { text:"天平路", url:"https://sorcbear.github.io/playground/circle", need:K_UNLOCK_CIRCLE, x:140, y:230, icon:svgBlue },
    { text:"康平路", url:"https://sorcbear.github.io/playground/square", need:K_UNLOCK_SQUARE, x:520, y:230, icon:svgGreen },
    { text:"衡山路", url:"https://sorcbear.github.io/playground/ppl",    need:K_UNLOCK_PPL,    x:520, y:360, icon:svgRed },
  ];

  function safeGet(storage, key){
    try{ return storage.getItem(key); }catch(e){ return null; }
  }

  // ✅ 同时读 localStorage + sessionStorage
  function unlocked(key){
    if (!key) return true;
    const a = safeGet(localStorage, key);
    const b = safeGet(sessionStorage, key);
    return !!(a || b);
  }

  // 顺序推进：没解锁就停
  function visible(){
    const out=[];
    for (const n of NODES){
      if (!unlocked(n.need)) break;
      out.push(n);
    }
    return out;
  }

  function render(){
    const map = document.getElementById("map");
    const wires = document.getElementById("wires");
    map.querySelectorAll(".node").forEach(n=>n.remove());
    wires.innerHTML = "";

    const v = visible();

    // 按钮
    for (const n of v){
      const wrap=document.createElement("div");
      wrap.className="node";
      wrap.style.left=n.x+"px";
      wrap.style.top=n.y+"px";

      const btn=document.createElement("button");
      btn.className="btn";
      btn.innerHTML=`<span class="ico">${n.icon()}</span><span>${n.text}</span>`;
      btn.onclick=()=>location.href=n.url;

      wrap.appendChild(btn);
      map.appendChild(wrap);
    }

    // 线段
    const add=(x1,y1,x2,y2)=>{
      const l=document.createElementNS("http://www.w3.org/2000/svg","line");
      l.setAttribute("x1",x1); l.setAttribute("y1",y1);
      l.setAttribute("x2",x2); l.setAttribute("y2",y2);
      l.setAttribute("stroke","#000");
      l.setAttribute("stroke-width", getComputedStyle(document.documentElement).getPropertyValue("--line-w").trim() || "4");
      l.setAttribute("stroke-linecap","square");
      wires.appendChild(l);
    };

    if (v.length>=2) add(NODES[0].x,NODES[0].y,NODES[1].x,NODES[1].y);
    if (v.length>=3) add(NODES[1].x,NODES[1].y,NODES[2].x,NODES[2].y);
    if (v.length>=4) add(NODES[2].x,NODES[2].y,NODES[3].x,NODES[3].y);

    // debug 面板（?debug=1）
    const params = new URLSearchParams(location.search);
    if (params.get("debug") === "1"){
      const box = document.createElement("div");
      box.className="debug";
      box.innerHTML =
        `<div><b>unlock check</b></div>` +
        `<div>local circle: ${safeGet(localStorage,K_UNLOCK_CIRCLE)}</div>` +
        `<div>sess  circle: ${safeGet(sessionStorage,K_UNLOCK_CIRCLE)}</div>` +
        `<div>local square: ${safeGet(localStorage,K_UNLOCK_SQUARE)}</div>` +
        `<div>sess  square: ${safeGet(sessionStorage,K_UNLOCK_SQUARE)}</div>` +
        `<div>local ppl: ${safeGet(localStorage,K_UNLOCK_PPL)}</div>` +
        `<div>sess  ppl: ${safeGet(sessionStorage,K_UNLOCK_PPL)}</div>`;
      document.body.appendChild(box);
    }
  }

  // 图标
  function svgStart(){
    return `
      <svg viewBox="0 0 64 64" aria-hidden="true">
        <circle cx="32" cy="32" r="26" fill="#F6B300"/>
        <path class="start-tri" d="M32 32L58 18v28L32 32Z"/>
      </svg>`;
  }
  function svgBlue(){
    return `<svg viewBox="0 0 64 64"><rect x="10" y="10" width="44" height="44" fill="#1E73D8"/></svg>`;
  }
  function svgGreen(){
    return `<svg viewBox="0 0 64 64"><circle cx="32" cy="32" r="22" fill="#2E7D32"/></svg>`;
  }
  function svgRed(){
    return `<svg viewBox="0 0 64 64"><path d="M32 8L56 32 32 56 8 32Z" fill="#D32F2F"/></svg>`;
  }

  render();
</script>
</body>
</html>
