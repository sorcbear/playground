<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>éŸ³ç¬¦è§£è°œ</title>

<style>
body{
  margin:0;
  background:#fff;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"PingFang SC","Hiragino Sans GB","Microsoft YaHei",sans-serif;
  color:#000;
}
.container{
  max-width:980px;
  margin:0 auto;
  padding:12px 12px 20px;
}
.status{
  font-size:18px;
  font-weight:600;
  margin-bottom:6px;
}
.status.error{color:#c00;}
.status.ok{color:#0a7;}
.controls{
  display:flex;
  gap:10px;
  margin:6px 0 6px;
}
button{
  border:none;
  border-radius:10px;
  padding:10px 16px;
  font-size:16px;
  cursor:pointer;
}
.btn-audio{background:#1bb35e;color:#fff;}
.btn{background:#000;color:#fff;}
.hint{
  font-size:15px;
  line-height:1.5;
  margin:6px 0 8px;
}
.keyboard-wrap{
  position:relative;
  margin-top:6px;
}
.keyboard-wrap img{
  width:100%;
  height:auto;
  display:block;
  user-select:none;
  -webkit-user-drag:none;
}
.overlay{
  position:absolute;
  left:0;top:0;right:0;bottom:0;
}
.key{
  position:absolute;
  top:0;
  bottom:0;
}
</style>
</head>

<body>
<div class="container">

  <div id="status" class="status">è¯·æŒ‰æ­£ç¡®éŸ³ç¬¦é¡ºåºå¼¹å¥ã€‚</div>

  <div class="controls">
    <button id="audioBtn" class="btn-audio">å¯ç”¨å£°éŸ³</button>
    <button id="resetBtn" class="btn">Reset</button>
  </div>

  <div class="hint">
    å»ºè®®æ¨ªå±æ“ä½œã€‚åªè¦æŒ‰å¯¹éŸ³ç¬¦é¡ºåºå³å¯ï¼›ç›¸é‚»ä¸¤æ¬¡ç‚¹å‡»é—´éš” â‰¤ 5 ç§’ï¼ˆè¶…æ—¶é‡ç½®ï¼‰ã€‚<br>
    iPhoneï¼šéœ€å…ˆç‚¹å‡»ä¸€æ¬¡â€œå¯ç”¨å£°éŸ³â€ã€‚
  </div>

  <div class="keyboard-wrap" id="kbWrap">
    <!-- ä½ çš„é”®ç›˜å›¾ç‰‡ -->
    <img src="keyboard.png" alt="keyboard">
    <div class="overlay" id="overlay"></div>
  </div>

</div>

<script>
/* ================= éŸ³ç¬¦å®šä¹‰ ================= */

// å›ºå®š 12 é”®ï¼ˆä»å·¦åˆ°å³ï¼‰
const KEYS = [
  "greensi",
  "reddo","redre","redmi","redfa","redso","redla","redsi",
  "bluedo","bluere","bluemi","bluefa"
];

// æ­£ç¡®ç­”æ¡ˆåºåˆ—ï¼ˆä½ ç»™çš„é‚£ä¸€æ•´ä¸²ï¼‰
const ANSWER = [
  "reddo","redmi","redso","bluedo","bluemi","redso","bluedo","bluemi",
  "reddo","redre","redla","bluere","bluefa","redla","bluere","bluefa",
  "greensi","redre","redso","bluere","bluefa","redso","bluere","bluefa",
  "reddo","redmi","redso","bluedo","bluemi","redso","bluedo","bluemi"
];

let idx = 0;
let lastTime = 0;

/* ================= éŸ³é¢‘ ================= */

let audioCtx = null;

function enableAudio(){
  if(!audioCtx){
    audioCtx = new (window.AudioContext||window.webkitAudioContext)();
  }
  document.getElementById("status").textContent="å£°éŸ³å·²å¯ç”¨";
  document.getElementById("status").className="status ok";
}

function playNote(key){
  if(!audioCtx) return;
  const freqMap={
    greensi:246.94,
    reddo:261.63,redre:293.66,redmi:329.63,redfa:349.23,redso:392.00,redla:440.00,redsi:493.88,
    bluedo:523.25,bluere:587.33,bluemi:659.25,bluefa:698.46
  };
  const o=audioCtx.createOscillator();
  const g=audioCtx.createGain();
  o.type="sine";
  o.frequency.value=freqMap[key];
  o.connect(g);g.connect(audioCtx.destination);
  const t=audioCtx.currentTime;
  g.gain.setValueAtTime(0,t);
  g.gain.linearRampToValueAtTime(0.4,t+0.02);
  g.gain.exponentialRampToValueAtTime(0.001,t+0.9);
  o.start(t);o.stop(t+0.95);
}

/* ================= åˆ¤å®š ================= */

function reset(msg){
  idx=0;
  lastTime=0;
  if(msg){
    const s=document.getElementById("status");
    s.textContent=msg;
    s.className="status error";
  }
}

function press(key){
  const now=Date.now();
  if(lastTime && now-lastTime>5000){
    reset("å·²è¶…æ—¶ï¼Œè¯·é‡æ–°å®Œæ•´å¼¹å¥ã€‚");
    return;
  }
  playNote(key);
  if(key!==ANSWER[idx]){
    reset(`å¤±è´¥ï¼šéŸ³ç¬¦é”™è¯¯ï¼šåº”ä¸º ${ANSWER[idx]}`);
    return;
  }
  idx++;
  lastTime=now;
  if(idx===ANSWER.length){
    const s=document.getElementById("status");
    s.textContent="ğŸ‰ æˆåŠŸï¼";
    s.className="status ok";
  }
}

/* ================= é”®ç›˜åŒºåŸŸï¼ˆ12 ç­‰åˆ†ï¼Œæœ€ç¨³å®šï¼‰ ================= */

function buildKeys(){
  const overlay=document.getElementById("overlay");
  overlay.innerHTML="";
  const w=overlay.clientWidth;
  const h=overlay.clientHeight;
  const keyW=w/12;
  for(let i=0;i<12;i++){
    const d=document.createElement("div");
    d.className="key";
    d.style.left=(i*keyW)+"px";
    d.style.width=keyW+"px";
    d.addEventListener("pointerdown",e=>{
      e.preventDefault();
      press(KEYS[i]);
    });
    overlay.appendChild(d);
  }
}

window.addEventListener("resize",buildKeys);

/* ================= äº‹ä»¶ ================= */

document.getElementById("audioBtn").onclick=enableAudio;
document.getElementById("resetBtn").onclick=()=>reset("å·²é‡ç½®ã€‚");

window.addEventListener("load",buildKeys);
</script>

</body>
</html>
