<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>paper pickup</title>

  <link rel="preload" as="image" href="p1.png">
  <link rel="preload" as="image" href="p2.png">

  <style>
    :root{
      /* ✅ 同源（Rotate） */
      --maxw: 720px;

      --fs-hint: 18px;
      --lh-hint: 1.6;

      /* ✅ 同源间距 */
      --gap: 18px;

      --bg:#fff;
      --c-text:#111;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    html,body{
      margin:0;
      background:var(--bg);
      /* ✅ 同源字体栈 */
      font-family: system-ui, -apple-system, "PingFang SC","Microsoft YaHei", Arial, sans-serif;
      color:var(--c-text);
      -webkit-text-size-adjust:100%;
    }

    .wrap{
      max-width:var(--maxw);
      margin:0 auto;
      /* ✅ 同源 padding（保证“距离顶部”一致） */
      padding:18px 14px 28px;
      box-sizing:border-box;
    }

    /* ✅ 顶部文字：同源 titleLine 规范（严格对齐 Rotate） */
    .UI.title{
      font-size: var(--fs-hint);
      line-height: var(--lh-hint);
      font-weight: 700;
      margin: 4px 0 var(--gap);
      text-align: left;
      white-space: pre-wrap;
    }

    /* ===== 顶部画板（不动） ===== */
    .stage{
      position:relative;
      width:100%;
      max-width:1024px;
      margin:0 auto;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    .stage::before{
      content:"";
      display:block;
      padding-top:74.70703125%; /* 765 / 1024 */
    }

    .layer{
      position:absolute;
      inset:0;
    }

    .layer img{
      width:100%;
      height:100%;
      object-fit:contain;
      display:block;
      pointer-events:none;
      backface-visibility:hidden;
      transform: translateZ(0);
    }

    /* p0 / p1：瞬时 opacity 切换，无过渡 */
    .imgA, .imgB{
      position:absolute;
      inset:0;
      opacity:0;
      transition:none;
      will-change: opacity;
    }
    .imgA{ opacity:1; }
    .revealed .imgA{ opacity:0; }
    .revealed .imgB{ opacity:1; }

    /* 纸卷热点（按最新图校准） */
    .hotspot{
      position:absolute;
      left:12.79%;
      top:71.24%;
      width:21.48%;
      height:12.42%;
      border:0;
      background:transparent;
      cursor:pointer;
      padding:0;
      margin:0;
      -webkit-tap-highlight-color: transparent;
    }
    .hotspot:disabled{
      pointer-events:none;
      cursor:default;
    }
    .hotspot:focus{ outline:none; }

    /* ===== p2：初始不可见 ===== */
    .pickup{
      max-width:1024px;
      margin:18px auto 0;

      visibility:hidden;
      opacity:0;
      transition:none;
      height:0;
      overflow:hidden;
    }

    .revealed ~ .pickup{
      visibility:visible;
      opacity:1;
      height:auto;
      overflow:visible;
    }

    .p2box{
      position:relative;
      user-select:none;
      -webkit-tap-highlight-color: transparent;
    }

    .p2box img{
      width:100%;
      height:auto;
      display:block;
      backface-visibility:hidden;
      transform: translateZ(0);
    }

    /* p2：仅白色卷轴本体（收紧版） */
    .p2btn{
      position:absolute;
      inset:auto;

      left:36.9%;
      top:4.8%;
      width:26.4%;
      height:90.2%;

      border:0;
      background:transparent;
      cursor:pointer;
      padding:0;
      margin:0;
      -webkit-tap-highlight-color: transparent;
    }

    .p2btn:focus{ outline:none; }
  </style>
</head>

<body>
  <div class="wrap">

    <p class="UI title">只有瑞金宾馆是在不同年代建成的，这幅画也许藏了什么秘密。翻过这幅画，原来背后藏了一张图纸，点击获取图纸，并查看图纸内容。</p>

    <div class="stage" id="stage">
      <div class="layer imgA">
        <img id="img0" src="p0.png" alt="">
      </div>
      <div class="layer imgB">
        <img id="img1" src="p1.png" alt="">
      </div>
      <button class="hotspot" id="hotspot" disabled></button>
    </div>

    <div class="pickup" id="pickup">
      <div class="p2box">
        <img id="img2" src="p2.png" alt="">
        <button class="p2btn" id="p2btn"></button>
      </div>
    </div>

  </div>

  <script>
    (function(){
      const stage = document.getElementById("stage");
      const btnRoll = document.getElementById("hotspot");
      const btnP2 = document.getElementById("p2btn");

      const img1 = document.getElementById("img1");
      const img2 = document.getElementById("img2");

      const NEXT_URL = "https://sorcbear.github.io/playground/paper";

      btnRoll.addEventListener("pointerdown", e=>e.preventDefault());
      btnP2.addEventListener("pointerdown", e=>e.preventDefault());

      async function waitReady(img){
        if (!img.complete) {
          await new Promise(res => img.addEventListener("load", res, {once:true}));
        }
        if (img.decode) {
          try{ await img.decode(); }catch(e){}
        }
      }

      (async ()=>{
        try{
          await Promise.all([waitReady(img1), waitReady(img2)]);
          btnRoll.disabled = false;
        }catch(e){}
      })();

      btnRoll.addEventListener("click", ()=>{
        if (btnRoll.disabled) return;
        stage.classList.add("revealed");
      });

      btnP2.addEventListener("click", ()=>{
        location.href = NEXT_URL;
      });
    })();
  </script>
</body>
</html>
