<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>address</title>

  <style>
    :root{
      --maxw: 720px;

      --fs-body: 16px;
      --lh-body: 1.7;

      --fs-hint: 18px;
      --lh-hint: 1.6;

      --gap: 18px;
      --gap-tight: 12px;

      --c-text: #111;
      --c-danger: #b00020;
      --c-border: #000;

      --ok:#0b6b2b;
      --bg:#fff;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }

    body{
      margin:0;
      background:var(--bg);
      color:var(--c-text);
      font-family: system-ui, -apple-system, "PingFang SC","Microsoft YaHei", Arial, sans-serif;
      font-size: var(--fs-body);
      line-height: var(--lh-body);
      -webkit-text-size-adjust: 100%;
    }

    .wrap{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 18px 14px 28px;
    }

    /* 标题 */
    .title{
      font-size: var(--fs-hint);
      line-height: var(--lh-hint);
      font-weight: 700;
      margin: 0;
    }

    /* 故事整体：不再使用 pre-wrap */
    .story{
      margin-top: var(--gap);
      font-size: var(--fs-hint);
      line-height: var(--lh-hint);
      font-weight: 700;
    }

    /* 已知行 */
    .known{
      margin: 0;
    }

    /* 对话整体：只在这里控制“隔一行” */
    .quotes{
      margin-top: 1em;   /* ← 只隔一行 */
    }

    /* 三句对白：紧贴、不空行 */
    .quote{
      margin: 0;
      font-style: italic;
      font-weight: 400;
      color: #000;
    }

    /* 结论行 */
    .conclusion{
      margin-top: 1em;
    }

    /* 红字提示 */
    .hint{
      margin-top: var(--gap-tight);
      font-size: 12px;
      line-height: 1.4;
      color: var(--c-danger);
      font-weight: 700;
    }

    /* 地址按钮网格 */
    .grid{
      margin-top: var(--gap);
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }
    @media (min-width: 820px){
      .grid{ grid-template-columns: repeat(3, minmax(0, 1fr)); }
    }

    /* 按钮样式 */
    button{
      width:240px;
      height:52px;
      padding:0 18px;
      font-size:16px;
      font-weight:600;
      background:#fff;
      color:#000;
      border:2px solid #000;
      cursor:pointer;
      border-radius:0;
      appearance:none;
      user-select:none;
    }
    button:hover{
      background:#000;
      color:#fff;
    }
    button:active{
      background:#000;
      color:#fff;
    }
    button:disabled{
      opacity:.45;
      cursor:default;
    }
    button.addr{ width:100%; }

    /* 状态文字 */
    .msg{
      margin-top: var(--gap-tight);
      min-height: 20px;
      font-size: 14px;
      line-height: 1.4;
    }
    .msg.ok{ color: var(--ok); font-weight: 700; }
    .msg.locked{ color: var(--c-danger); font-weight: 700; }

    /* 提示按钮 */
    .hintBtnRow{
      margin-top: var(--gap);
      display:flex;
      justify-content:center;
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="title">
      你遇到2个玩家A和B，他们在讨论下个谜题的地点。现在知道下个谜题在以下10个可能的地点之一：
    </div>

    <div class="story">
      <div class="known">已知：A知道街道名，B知道弄堂号码。</div>

      <div class="quotes">
        <div class="quote">A说：“我不知道具体地点，但我知道B也不知道。”</div>
        <div class="quote">B说：“起初我不知道，但现在我知道了。”</div>
        <div class="quote">A说：“那我现在知道下个谜题在哪了。”</div>
      </div>

      <div class="conclusion">那么下个谜题在哪里？请点击下面的正确地址。</div>
    </div>

    <div class="hint">提示：点击错误会导致本页面冻结3分钟。</div>

    <div class="grid" id="btnGrid"></div>

    <div class="msg" id="msg"></div>

    <div class="hintBtnRow">
      <button id="btnHint" type="button">获得提示</button>
    </div>
  </div>

<script>
(() => {
  const NEXT_URL = "https://sorcbear.github.io/playground/square/";
  const HINT_URL = "https://sorcbear.github.io/playground/address/hint";
  const LOCK_MS = 1 * 60 * 1000;
  const STORAGE_LOCK_UNTIL = "riddle_addr_lock_until_ts";

  const ADDRS = [
    "天平路75弄","天平路152弄","天平路216弄",
    "余庆路80弄","余庆路51弄",
    "康平路101弄","康平路152弄",
    "宛平路75弄","宛平路80弄","宛平路101弄"
  ];
  const CORRECT = "康平路152弄";

  const grid = document.getElementById("btnGrid");
  const msgEl = document.getElementById("msg");
  const btnHint = document.getElementById("btnHint");

  let lockTimer=null, successTimer=null, inSuccess=false;

  const now=()=>Date.now();
  const fmt=t=>{
    t=Math.max(0,Math.ceil(t/1000));
    return `${String(Math.floor(t/60)).padStart(2,"0")}:${String(t%60).padStart(2,"0")}`;
  };

  const getLock=()=>Number(localStorage.getItem(STORAGE_LOCK_UNTIL)||0);
  const setLock=t=>localStorage.setItem(STORAGE_LOCK_UNTIL,String(t));
  const clearLock=()=>localStorage.removeItem(STORAGE_LOCK_UNTIL);

  const setBtns=e=>{
    grid.querySelectorAll("button.addr").forEach(b=>b.disabled=!e);
    btnHint.disabled=!e;
  };
  const show=(t,k)=>{msgEl.textContent=t||"";msgEl.className="msg"+(k?" "+k:"");};

  function startLock(){
    clearInterval(lockTimer);
    const tick=()=>{
      if(inSuccess)return;
      const left=getLock()-now();
      if(left>0){
        setBtns(false);
        show(`页面已冻结：${fmt(left)}`,"locked");
      }else{
        clearLock();setBtns(true);show("");
        clearInterval(lockTimer);lockTimer=null;
      }
    };
    tick();lockTimer=setInterval(tick,250);
  }

  function success(){
    inSuccess=true;setBtns(false);
    let n=3;show(`答案正确，即将进入下一题（${n}）`,"ok");
    successTimer=setInterval(()=>{
      n--;if(n>0)show(`答案正确，即将进入下一题（${n}）`,"ok");
      else{clearInterval(successTimer);location.href=NEXT_URL;}
    },1000);
  }

  function clickAddr(a){
    if(inSuccess)return;
    if(getLock()>now()){startLock();return;}
    if(a===CORRECT){success();return;}
    setLock(now()+LOCK_MS);startLock();
  }

  ADDRS.forEach(a=>{
    const b=document.createElement("button");
    b.className="addr";
    b.textContent=a;
    b.onclick=()=>clickAddr(a);
    grid.appendChild(b);
  });

  btnHint.onclick=()=>{
    if(inSuccess||getLock()>now())return;
    location.href=HINT_URL;
  };

  startLock();
})();
</script>
</body>
</html>
