<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barrel Puzzle</title>
  <style>
    :root{
      --bg: #ffffff;
      --text: #111;
      --stroke: #0b0f2e;
      --fill: #243B8F;
      --cardMaxW: 320px; /* 单张牌最大宽度（手机会自动缩小） */
      --gap: 14px;
    }
    html,body{height:100%;}
    body{
      margin:0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "PingFang SC", "Noto Sans CJK SC", "Microsoft YaHei", sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .wrap{
      width:min(1100px, 94vw);
      padding: 18px 0 22px;
    }

    /* 上方三张牌 */
    .cards{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: var(--gap);
      align-items: stretch;
    }

    .card{
      position:relative;
      width: 100%;
      max-width: var(--cardMaxW);
      margin: 0 auto;
      aspect-ratio: 718 / 1024; /* 你的图案尺寸比例 */
      border-radius: 10px;
      overflow:hidden;
      background:#fff;
      box-shadow: 0 8px 26px rgba(0,0,0,0.08);
    }

    .pattern{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      user-select:none;
      -webkit-user-drag:none;
      pointer-events:none;
    }

    /* 数字层：用文本渲染（方法1），看起来像矢量 */
    .digit{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      font-family: "Cinzel", "Times New Roman", Georgia, serif;
      font-size: clamp(72px, 10vw, 170px);
      line-height: 1;
      color: var(--fill);
      user-select:none;
      letter-spacing: 0.02em;

      /* 模拟描边：多重阴影 */
      text-shadow:
        -2px -2px 0 var(--stroke),
         2px -2px 0 var(--stroke),
        -2px  2px 0 var(--stroke),
         2px  2px 0 var(--stroke),
        0px  3px 0 rgba(0,0,0,0.15);
    }

    .hint{
      margin: 14px auto 10px;
      text-align:center;
      font-size: 14px;
      opacity: 0.78;
    }

    /* 下方按钮 */
    .buttons{
      display:flex;
      gap: 22px;
      justify-content:center;
      align-items:center;
      margin-top: 10px;
    }

    .coinBtn{
      width: 76px;
      height: 76px;
      border:none;
      background: transparent;
      padding:0;
      cursor:pointer;
      border-radius: 999px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.14);
    }
    .coinBtn:disabled{
      cursor:not-allowed;
      opacity: 0.55;
      box-shadow:none;
    }
    .coinBtn img{
      width:100%;
      height:100%;
      display:block;
      user-select:none;
      -webkit-user-drag:none;
      pointer-events:none;
    }

    .status{
      margin-top: 12px;
      text-align:center;
      min-height: 22px;
      font-weight: 600;
    }

    /* 小屏优化：三列变一列 */
    @media (max-width: 820px){
      .cards{ grid-template-columns: 1fr; }
      .card{ max-width: min(92vw, 420px); }
      .buttons{ gap: 18px; }
      .coinBtn{ width: 72px; height: 72px; }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="cards">
      <div class="card" id="card1">
        <img class="pattern" id="pat1" alt="pattern-1">
        <div class="digit" id="dig1">1</div>
      </div>
      <div class="card" id="card2">
        <img class="pattern" id="pat2" alt="pattern-2">
        <div class="digit" id="dig2">5</div>
      </div>
      <div class="card" id="card3">
        <img class="pattern" id="pat3" alt="pattern-3">
        <div class="digit" id="dig3">7</div>
      </div>
    </div>

    <div class="hint">点击下方金币切换上方牌面，组合正确后显示 success。</div>

    <div class="buttons">
      <button class="coinBtn" id="btn1" aria-label="按钮1">
        <img src="coin.png" alt="coin">
      </button>
      <button class="coinBtn" id="btn2" aria-label="按钮2">
        <img src="coin.png" alt="coin">
      </button>
      <button class="coinBtn" id="btn3" aria-label="按钮3">
        <img src="coin.png" alt="coin">
      </button>
    </div>

    <div class="status" id="status"></div>
  </div>

  <script>
    // ====== 资源：4 张图案（按顺序循环）======
    const patterns = ["p0.png", "p1.png", "p2.png", "p3.png"];

    // ====== 状态定义：数字 1-9 循环；图案 0-3 循环 ======
    // 初始状态（你可随意改）
    let D = [1, 5, 7];     // D1 D2 D3
    let P = [2, 1, 1];     // P1 P2 P3  (0..3)

    // 目标状态（你可随意改；这里给一组“保证有解”的目标）
    // 目标：左A4 中C7 右D2  -> 用 0..3 表示 A/B/C/D
    // 假设：A=0,B=1,C=2,D=3
    const targetD = [4, 7, 2];
    const targetP = [0, 2, 3];

    // ====== 三个按钮规则（纸翻页式，按一下立刻切换）======
    // 按钮1：D1+1，P2+1
    // 按钮2：P1+1，D2+1，D3+1
    // 按钮3：D3+1，P2+1，P3+1
    function pressButton(k){
      if(k === 1){
        D[0] = incDigit(D[0]);
        P[1] = incPattern(P[1]);
      }else if(k === 2){
        P[0] = incPattern(P[0]);
        D[1] = incDigit(D[1]);
        D[2] = incDigit(D[2]);
      }else if(k === 3){
        D[2] = incDigit(D[2]);
        P[1] = incPattern(P[1]);
        P[2] = incPattern(P[2]);
      }
      render();
      checkWin();
    }

    function incDigit(x){
      // 1..9 循环
      return (x % 9) + 1;
    }
    function incPattern(x){
      // 0..3 循环
      return (x + 1) % patterns.length;
    }

    // ====== 渲染 ======
    const digEls = [document.getElementById("dig1"), document.getElementById("dig2"), document.getElementById("dig3")];
    const patEls = [document.getElementById("pat1"), document.getElementById("pat2"), document.getElementById("pat3")];
    const statusEl = document.getElementById("status");

    function render(){
      for(let i=0;i<3;i++){
        digEls[i].textContent = String(D[i]);
        patEls[i].src = patterns[P[i]];
      }
      statusEl.textContent = ""; // 每次操作清空状态提示（成功时会覆盖）
    }

    function isWin(){
      for(let i=0;i<3;i++){
        if(D[i] !== targetD[i]) return false;
        if(P[i] !== targetP[i]) return false;
      }
      return true;
    }

    function checkWin(){
      if(isWin()){
        statusEl.textContent = "success";
        // 如需成功后跳转到下一关，取消注释并改路径：
        // window.location.href = "../nextpage/";
      }
    }

    // ====== 绑定按钮 ======
    document.getElementById("btn1").addEventListener("click", ()=>pressButton(1));
    document.getElementById("btn2").addEventListener("click", ()=>pressButton(2));
    document.getElementById("btn3").addEventListener("click", ()=>pressButton(3));

    // 首次渲染
    render();

    // （可选）把目标写在控制台，便于你调试
    console.log("Target D:", targetD, "Target P:", targetP);
  </script>
</body>
</html>
