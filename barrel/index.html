<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Barrel Puzzle</title>
  <style>
    :root{
      --bg: #ffffff;
      --stroke: #0b0f2e;
      --fill: #243B8F;

      /* 三张牌拼接：外框与分隔线 */
      --frameLine: 4px;     /* 外框线宽 */
      --dividerLine: 4px;   /* 中间分隔线宽 */
      --lineColor: #000000;

      /* 翻页速度（越大越慢） */
      --flipMs: 360ms;

      /* 数字大小：再大一点 */
      --digitMin: 170px;
      --digitVW: 20vw;
      --digitMax: 320px;

      /* 按钮更小 */
      --btnSize: 56px;
    }

    html,body{height:100%;}
    body{
      margin:0;
      background: var(--bg);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "PingFang SC", "Noto Sans CJK SC", "Microsoft YaHei", sans-serif;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .wrap{
      width:min(1200px, 94vw);
      padding: 16px 0 18px;
    }

    /* 让三张牌像一张长牌：外层加外框 */
    .strip{
      display:grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 0; /* 关键：无空隙 */
      border: var(--frameLine) solid var(--lineColor);
      border-radius: 18px;
      overflow:hidden; /* 让内侧圆角不会露白 */
      background:#fff;
    }

    .card{
      position:relative;
      aspect-ratio: 718 / 1024;
      background:#fff;

      /* 3D 透视：向上翻页 */
      perspective: 1000px;
      overflow:hidden;
    }

    /* 中间分隔线：只在第1、第2张右边加线 */
    .card.sep{
      border-right: var(--dividerLine) solid var(--lineColor);
    }

    /* 牌面内容层：做翻页 */
    .face{
      position:absolute;
      inset:0;
      transform-style: preserve-3d;
      backface-visibility: hidden;

      /* 默认状态 */
      transform: rotateX(0deg);
      transform-origin: bottom center; /* 从底部向上翻 */
      transition: transform var(--flipMs) ease-in-out;
      will-change: transform;
    }

    /* 先翻到 90 度（内容不可见），在这个瞬间换图换字不会闪 */
    .face.flipOut{
      transform: rotateX(-90deg);
    }

    .pattern{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      user-select:none;
      -webkit-user-drag:none;
      pointer-events:none;
    }

    .digitWrap{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      pointer-events:none;
    }

    /* 数字：更大 + 干净描边（无重影） */
    .digit{
      font-family: "Cinzel", "Times New Roman", Georgia, serif;
      font-size: clamp(var(--digitMin), var(--digitVW), var(--digitMax));
      line-height: 1;
      letter-spacing: 0.01em;

      color: var(--fill);
      -webkit-text-stroke: 7px var(--stroke);
      paint-order: stroke fill;

      text-shadow: 0 7px 0 rgba(0,0,0,0.12);
      user-select:none;
    }

    .hint{
      margin: 12px auto 10px;
      text-align:center;
      font-size: 14px;
      opacity: 0.78;
    }

    .buttons{
      display:flex;
      gap: 16px;
      justify-content:center;
      align-items:center;
      margin-top: 10px;
    }

    .coinBtn{
      width: var(--btnSize);
      height: var(--btnSize);
      border:none;
      background: transparent;
      padding:0;
      cursor:pointer;
      border-radius: 999px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.14);
    }
    .coinBtn:disabled{
      cursor:not-allowed;
      opacity: 0.55;
      box-shadow:none;
    }
    .coinBtn img{
      width:100%;
      height:100%;
      display:block;
      user-select:none;
      -webkit-user-drag:none;
      pointer-events:none;
    }

    .status{
      margin-top: 10px;
      text-align:center;
      min-height: 22px;
      font-weight: 600;
    }

    /* 手机：保证整体不超宽 */
    @media (max-width: 900px){
      :root{
        --btnSize: 52px;
        --digitMax: 300px;
        --frameLine: 3px;
        --dividerLine: 3px;
      }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="strip">
      <div class="card sep">
        <div class="face" id="face1">
          <img class="pattern" id="pat1" alt="pattern-1">
          <div class="digitWrap"><div class="digit" id="dig1">1</div></div>
        </div>
      </div>

      <div class="card sep">
        <div class="face" id="face2">
          <img class="pattern" id="pat2" alt="pattern-2">
          <div class="digitWrap"><div class="digit" id="dig2">5</div></div>
        </div>
      </div>

      <div class="card">
        <div class="face" id="face3">
          <img class="pattern" id="pat3" alt="pattern-3">
          <div class="digitWrap"><div class="digit" id="dig3">7</div></div>
        </div>
      </div>
    </div>

    <div class="hint">点击下方金币切换上方牌面，组合正确后显示 success。</div>

    <div class="buttons">
      <button class="coinBtn" id="btn1" aria-label="按钮1"><img src="coin.png" alt="coin"></button>
      <button class="coinBtn" id="btn2" aria-label="按钮2"><img src="coin.png" alt="coin"></button>
      <button class="coinBtn" id="btn3" aria-label="按钮3"><img src="coin.png" alt="coin"></button>
    </div>

    <div class="status" id="status"></div>

  </div>

  <script>
    // 4 张图案（按顺序循环）
    const patterns = ["p0.png", "p1.png", "p2.png", "p3.png"];

    // 数字：1..9 循环；图案：0..3 循环
    let D = [1, 1, 3];     // 你现在截图类似 1 / 1 / 3，我按这个做默认
    let P = [1, 2, 1];     // 图案初始随便给一组，你可改

    // 目标（你可改）
    const targetD = [4, 7, 2];
    const targetP = [0, 2, 3]; // A=0,B=1,C=2,D=3（你自己定义 A/B/C/D 对应 p0..p3）

    const digEls  = [document.getElementById("dig1"), document.getElementById("dig2"), document.getElementById("dig3")];
    const patEls  = [document.getElementById("pat1"), document.getElementById("pat2"), document.getElementById("pat3")];
    const faceEls = [document.getElementById("face1"), document.getElementById("face2"), document.getElementById("face3")];
    const statusEl = document.getElementById("status");

    const btn1 = document.getElementById("btn1");
    const btn2 = document.getElementById("btn2");
    const btn3 = document.getElementById("btn3");

    function incDigit(x){ return (x % 9) + 1; }
    function incPattern(x){ return (x + 1) % patterns.length; }

    // 规则：
    // 按钮1：D1+1，P2+1
    // 按钮2：P1+1，D2+1，D3+1
    // 按钮3：所有数字 +1（图案不变）  —— 按你的新要求
    function applyRule(k){
      if(k === 1){
        D[0] = incDigit(D[0]);
        P[1] = incPattern(P[1]);
      }else if(k === 2){
        P[0] = incPattern(P[0]);
        D[1] = incDigit(D[1]);
        D[2] = incDigit(D[2]);
      }else if(k === 3){
        D[0] = incDigit(D[0]);
        D[1] = incDigit(D[1]);
        D[2] = incDigit(D[2]);
        // P 不变
      }
    }

    function renderImmediate(){
      for(let i=0;i<3;i++){
        digEls[i].textContent = String(D[i]);
        patEls[i].src = patterns[P[i]];
      }
      statusEl.textContent = "";
    }

    function isWin(){
      for(let i=0;i<3;i++){
        if(D[i] !== targetD[i]) return false;
        if(P[i] !== targetP[i]) return false;
      }
      return true;
    }

    function checkWin(){
      if(isWin()){
        statusEl.textContent = "success";
        // window.location.href = "../nextpage/";
      }
    }

    function setButtonsDisabled(disabled){
      btn1.disabled = disabled;
      btn2.disabled = disabled;
      btn3.disabled = disabled;
    }

    function getFlipMs(){
      const v = getComputedStyle(document.documentElement).getPropertyValue("--flipMs").trim();
      const n = parseInt(v.replace("ms",""), 10);
      return Number.isFinite(n) ? n : 360;
    }
    function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

    // 向上翻页：flipOut(到-90deg) -> 换内容 -> 回到0deg
    async function pressButton(k){
      setButtonsDisabled(true);

      faceEls.forEach(el => el.classList.add("flipOut"));
      const flipMs = getFlipMs();
      await sleep(flipMs);

      applyRule(k);
      renderImmediate();

      faceEls.forEach(el => el.classList.remove("flipOut"));
      await sleep(flipMs);

      checkWin();
      setButtonsDisabled(false);
    }

    btn1.addEventListener("click", ()=>pressButton(1));
    btn2.addEventListener("click", ()=>pressButton(2));
    btn3.addEventListener("click", ()=>pressButton(3));

    renderImmediate();
  </script>
</body>
</html>
